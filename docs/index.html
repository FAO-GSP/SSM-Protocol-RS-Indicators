<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Supplementary RS Indicators</title>
  <meta name="description" content="Supplementary RS Indicators" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Supplementary RS Indicators" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Supplementary RS Indicators" />
  
  
  

<meta name="author" content="" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="#supplementary-remote-rensing-indicators"><i class="fa fa-check"></i><b>1</b> Supplementary remote rensing indicators</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="#ndvi-evolution-within-the-project-area-using-modis"><i class="fa fa-check"></i><b>1.1</b> NDVI evolution within the project area using MODIS</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="#step-1-delineate-the-area-of-interest-aoi-in-gee"><i class="fa fa-check"></i><b>1.1.1</b> Step 1 | Delineate the Area of Interest (AOI) in GEE:</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="#option-1-drawing-a-geometry-directly-in-gee"><i class="fa fa-check"></i><b>1.1.2</b> Option 1: Drawing a geometry directly in GEE</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="#option-2-uploading-a-shapefile-into-gee"><i class="fa fa-check"></i><b>1.1.3</b> Option 2: Uploading a shapefile into GEE</a></li>
<li class="chapter" data-level="1.1.4" data-path="index.html"><a href="#step-2-copy-paste-and-run-the-provided-scripts-into-gee"><i class="fa fa-check"></i><b>1.1.4</b> Step 2 | Copy, paste and run the provided scripts into GEE</a></li>
<li class="chapter" data-level="1.1.5" data-path="index.html"><a href="#script-1-ndvi-trend-over-a-larger-area-with-modis"><i class="fa fa-check"></i><b>1.1.5</b> <strong>Script 1: NDVI trend over a larger area with Modis</strong></a></li>
<li class="chapter" data-level="1.1.6" data-path="index.html"><a href="#step-3-export-and-analyse-your-output"><i class="fa fa-check"></i><b>1.1.6</b> Step 3 | Export and analyse your output</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="#estimating-and-comparing-the-ndvi-evolution-over-plots-that-have-been-subjected-to-ssm-practices-against-control-plots-with-a-sentinel-product"><i class="fa fa-check"></i><b>1.2</b> Estimating and comparing the NDVI evolution over plots that have been subjected to SSM practices against control plots with a Sentinel product</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="#step-1-delineate-two-areas-for-comparison-in-gee"><i class="fa fa-check"></i><b>1.2.1</b> Step 1 | Delineate two areas for comparison in GEE</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="#step-2-copy-paste-and-run-the-provided-scripts-into-gee-1"><i class="fa fa-check"></i><b>1.2.2</b> Step 2 | Copy, paste and run the provided scripts into GEE</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="#script-2-ndvi-trend-comparison-over-two-plots-with-sentinel"><i class="fa fa-check"></i><b>1.2.3</b> <strong>Script 2: NDVI trend comparison over two plots with Sentinel</strong></a></li>
<li class="chapter" data-level="1.2.4" data-path="index.html"><a href="#step-3-export-and-test-for-significant-differences"><i class="fa fa-check"></i><b>1.2.4</b> Step 3 | Export and test for significant differences</a></li>
<li class="chapter" data-level="1.2.5" data-path="index.html"><a href="#script-2.1-example-of-potential-data-visualization-with-the-output-csv-file-with-a-one-way-anova-in-r."><i class="fa fa-check"></i><b>1.2.5</b> <strong>Script 2.1 Example of potential data visualization with the output csv file with a one-way Anova in R.</strong></a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="#estimating-vegetation-cover-ratios-to-compare-the-effects-of-ssm"><i class="fa fa-check"></i><b>1.3</b> Estimating vegetation cover ratios to compare the effects of SSM</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="#script-3-vegetation-cover-ratio-trend-comparison-over-two-plots-with-sentinel"><i class="fa fa-check"></i><b>1.3.1</b> <strong>Script 3: Vegetation cover ratio trend comparison over two plots with Sentinel</strong></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="#assessing-ssm-through-bare-soil-index-bsi"><i class="fa fa-check"></i><b>1.4</b> Assessing SSM through Bare Soil Index (BSI)</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="#script-4-bare-soil-index-trend-comparison-for-the-whole-area-using-modis"><i class="fa fa-check"></i><b>1.4.1</b> <strong>Script 4: Bare Soil Index trend comparison for the whole area using MODIS</strong></a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="#script-5-bare-soil-index-trend-comparison-over-two-plots-with-sentinel"><i class="fa fa-check"></i><b>1.4.2</b> <strong>Script 5: Bare Soil Index trend comparison over two plots with Sentinel</strong></a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="#assessing-ssm-through-the-normalized-difference-water-index-ndwi"><i class="fa fa-check"></i><b>1.5</b> Assessing SSM through the Normalized Difference Water Index (NDWI)</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="#script-6-ndwi-trend-comparison-for-the-whole-area-using-modis"><i class="fa fa-check"></i><b>1.5.1</b> <strong>Script 6: NDWI trend comparison for the whole area using MODIS</strong></a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="#script-7-ndwi-trend-comparison-over-two-plots-with-sentinel"><i class="fa fa-check"></i><b>1.5.2</b> <strong>Script 7: NDWI trend comparison over two plots with Sentinel</strong></a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="#presenting-and-explaining-the-gee-results-to-assess-ssm"><i class="fa fa-check"></i><b>1.6</b> Presenting and explaining the GEE results to assess SSM</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="index.html"><a href="#example-project-area"><i class="fa fa-check"></i><b>1.6.1</b> Example Project Area</a></li>
<li class="chapter" data-level="1.6.2" data-path="index.html"><a href="#interpreting-the-results"><i class="fa fa-check"></i><b>1.6.2</b> Interpreting the results</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Supplementary RS Indicators</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Supplementary RS Indicators</h1>
<p class="author"><em></em></p>
</div>
<div id="supplementary-remote-rensing-indicators" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> Supplementary remote rensing indicators<a href="#supplementary-remote-rensing-indicators" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This document provides the scripts and a short user manual to derive the supplementary indicators for an SSM assessment through remote sensing. It is meant as a supplementary material to the User Manual of the SSM Protocol (reference here).
The following indicators mentioned in the User Manual of the SSM Protocol will be used:</p>
<ul>
<li>NDVI</li>
<li>BSI</li>
<li>NWI</li>
</ul>
<p>Additionally, a short guide for the visualization and interpretation of the remotely sensed indicator is provided.</p>
<div id="ndvi-evolution-within-the-project-area-using-modis" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> NDVI evolution within the project area using MODIS<a href="#ndvi-evolution-within-the-project-area-using-modis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following section presents a step by step guide to derive MODIS based spectral images to quantify changes in NDVI values linked to SSM for an entire project area. The MODIS product MOD09A1 is suggested due to its extensive time coverage (2000 to present time). A script to be imputed into Google Earth Engine is provided.</p>
<p>The example area has undergone change in terms of land use (extensive pasture to a mosaic of silvopastoral areas and perennial crops).</p>
<div id="step-1-delineate-the-area-of-interest-aoi-in-gee" class="section level3 hasAnchor" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Step 1 | Delineate the Area of Interest (AOI) in GEE:<a href="#step-1-delineate-the-area-of-interest-aoi-in-gee" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="option-1-drawing-a-geometry-directly-in-gee" class="section level3 hasAnchor" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Option 1: Drawing a geometry directly in GEE<a href="#option-1-drawing-a-geometry-directly-in-gee" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To locate your Area of Interest (AOI), the search bar over the three windows can be used to find a reference location (Figure 1).</p>
<div class="figure">
<img src="images/fig1.png" alt="" />
<p class="caption">Figure 1 GEE search bar</p>
</div>
<p>Below the three windows, a toolbar can be found. A geometry (marker, line, shape or rectangle) can be directly inputted into GEE by selecting the geometry type and drawing it directly into the map below (Figure 2).</p>
<div class="figure">
<img src="images/fig2.png" alt="" />
<p class="caption">Figure 2 Geometry tools</p>
</div>
<p>In this example, a geometry is added by clicking on the shape tool. The map view can be switched to satellite to ease delineation of the AOI. Once completed the script editor gets automatically updated (Figure 3).</p>
<div class="figure">
<img src="images/fig3.png" alt="" />
<p class="caption">Figure 3 Using the geometry tools to draw a geometry directly into GEE</p>
</div>
</div>
<div id="option-2-uploading-a-shapefile-into-gee" class="section level3 hasAnchor" number="1.1.3">
<h3><span class="header-section-number">1.1.3</span> Option 2: Uploading a shapefile into GEE<a href="#option-2-uploading-a-shapefile-into-gee" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Assets tab on the first window of GEE can be used to upload a shapefile. To upload click on: Assets &gt;&gt; New &gt;&gt; Shape files (Figure 4).</p>
<div class="figure">
<img src="images/fig4.png" alt="" />
<p class="caption">Figure 4 Assets tab in GEE</p>
</div>
<p>After opening the asset window, click on upload, navigate to your shapefile with the file explorer, select all the accompanying files and click on ok. Scroll down the asset window and click on upload (Figure 5).</p>
<div class="figure">
<img src="images/fig5.png" alt="" />
<p class="caption">Figure 5 Upload a new shapefile asset window</p>
</div>
<p>After clicking on upload, the shapefile will start ingesting. The progress of the file upload can be seen on the third window under the Task tab. Once the message ingest table under the Task section has turned blue the file can be seen by clicking on refresh, which is located in the first window under Assets (Figure 6).</p>
<p><img src="images/fig6.png" alt="Figure 6 Progress overview of uploading a shapefile into GEE" />
To import the shapefile, click on the shapefile name, scroll down the window and click on Import (Figure 7).</p>
<div class="figure">
<img src="images/fig7.png" alt="" />
<p class="caption">Figure 7 Import overview</p>
</div>
<p>The code editor will update automatically. In order to work directly with the provided script, the shapefile needs to be renamed to “area” (Figure 8).</p>
<div class="figure">
<img src="images/fig8.png" alt="" />
<p class="caption">Figure 8 Shapefile correctly uploaded to GEE and renamed to “area”.</p>
</div>
</div>
<div id="step-2-copy-paste-and-run-the-provided-scripts-into-gee" class="section level3 hasAnchor" number="1.1.4">
<h3><span class="header-section-number">1.1.4</span> Step 2 | Copy, paste and run the provided scripts into GEE<a href="#step-2-copy-paste-and-run-the-provided-scripts-into-gee" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once a geometry has been created or imported into GEE and renamed to “area”, the following script can be copied, pasted and runed into GEE without any modification. The script was designed to provide the following outputs for the AOI:</p>
<ul>
<li>NDVI median values (two per month) over a specified time period that can be exported as a table and/or graph</li>
<li>A graph showing the mean yearly NDVI values</li>
<li>The selected NDVI images</li>
</ul>
<p>To execute the script, copy the provided script below (Script 1) in its entirety, paste it into the code editor and click on Run (Figure 9).</p>
<div class="figure">
<img src="images/fig9.png" alt="" />
<p class="caption">Figure 9 Script copied to the code editor and Run button.</p>
</div>
</div>
<div id="script-1-ndvi-trend-over-a-larger-area-with-modis" class="section level3 hasAnchor" number="1.1.5">
<h3><span class="header-section-number">1.1.5</span> <strong>Script 1: NDVI trend over a larger area with Modis</strong><a href="#script-1-ndvi-trend-over-a-larger-area-with-modis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++// </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Script 1: NDVI trend over a larger area </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">// with MODIS</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">// SSM-Prtocol 08/03/21</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">// This script was created by the GSP-Secretariat</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Authors: Luciano E. Di Paolo, Guillermo E. Peralta, Isabel Luotto. </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Find out more about the Global Soil Partnership:</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">// http://www.fao.org/global-soil-partnership/en/ </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++//</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Display yout Area of Interest (AOI)</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(area<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;Area of interest&#39;</span>)<span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">//Zoom to layer</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">//Select MODIS images from MOD13Q1</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> NDVIdata <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;MODIS/006/MOD13Q1&#39;</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">filterBounds</span>(area)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select the years to perform the analysis</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">2010</span><span class="op">,</span><span class="dv">2020</span><span class="op">,</span><span class="st">&#39;year&#39;</span>))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Select the months to perform the analysis</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">1</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="st">&#39;month&#39;</span>))<span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Extract NDVI layer from the Mod13.Q1 product (250m)</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi <span class="op">=</span> NDVIdata<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;NDVI&#39;</span>)<span class="op">;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> scale <span class="op">=</span> <span class="kw">function</span>(image){</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span> (image<span class="op">.</span><span class="fu">expression</span>(</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;ndvi=b1*0.0001&#39;</span><span class="op">,</span> {</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b1&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;NDVI&#39;</span>)}))<span class="op">;</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi <span class="op">=</span> ndvi<span class="op">.</span><span class="fu">map</span>(scale)<span class="op">;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndviMed<span class="op">=</span> ndvi<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndviMed<span class="op">=</span> ndviMed<span class="op">.</span><span class="fu">clip</span>(area)<span class="op">;</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co">// Show temporal median image of NDVI</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(ndviMed<span class="op">,</span>{<span class="st">&#39;bands&#39;</span><span class="op">:</span> [<span class="st">&#39;ndvi&#39;</span>]<span class="op">,</span><span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;palette&quot;</span><span class="op">:</span><span class="st">&quot;FFFFFF, CE7E45, DF923D, F1B555, FCD163, 99B718, 74A901, 66A000, 529400, 3E8601, 207401, 056201, 004C00, 023B01, 012E01, 011D01, 011301&quot;</span>}<span class="op">,</span> <span class="st">&quot;NDVI temporal Median&quot;</span>)<span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co">//Zoom to layer</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(area<span class="op">,</span> <span class="dv">15</span>)<span class="op">;</span> <span class="co">//Modify the zoom number depending on the size of the feature</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co">// Download Temporal Median Images</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(ndviMed<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> ndviMed<span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;ndvi&quot;</span>)<span class="op">,</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;working_directory&quot;</span><span class="op">,</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;NDVI_median_Modis_m01-m012_00-20&#39;</span><span class="op">,</span> </span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">250</span><span class="op">,</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span>area<span class="op">,</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>          <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a time series chart.</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> plotNDVI <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">seriesByRegion</span>(ndvi<span class="op">,</span> area<span class="op">,</span>ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;ndvi&#39;</span><span class="op">,</span><span class="dv">250</span><span class="op">,</span><span class="st">&#39;system:time_start&#39;</span><span class="op">,</span><span class="st">&#39;name&#39;</span>)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">setChartType</span>(<span class="st">&#39;LineChart&#39;</span>)<span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>                <span class="dt">trendlines</span><span class="op">:</span> {<span class="dt">type</span><span class="op">:</span> linear<span class="op">,</span> <span class="dv">0</span><span class="op">:</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;CC0000&#39;</span>}<span class="op">,</span> <span class="dt">visibleInLegend</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>                <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Mean Normalized Difference Vegetation Index &#39;</span><span class="op">,</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Date&#39;</span>}<span class="op">,</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>                <span class="dt">vAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;NDVI&#39;</span>}</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co">// Display.</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plotNDVI)<span class="op">;</span></span></code></pre></div>
</div>
<div id="step-3-export-and-analyse-your-output" class="section level3 hasAnchor" number="1.1.6">
<h3><span class="header-section-number">1.1.6</span> Step 3 | Export and analyse your output<a href="#step-3-export-and-analyse-your-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The resulting output can be viewed directly in the console tab in the third GEE window. To export the graph and data as an image and/or tabular data click on the arrow icon in the console (Figure 10).</p>
<div class="figure">
<img src="images/fig10.png" alt="" />
<p class="caption">Figure 10 Window to export the results from GEE.</p>
</div>
</div>
</div>
<div id="estimating-and-comparing-the-ndvi-evolution-over-plots-that-have-been-subjected-to-ssm-practices-against-control-plots-with-a-sentinel-product" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Estimating and comparing the NDVI evolution over plots that have been subjected to SSM practices against control plots with a Sentinel product<a href="#estimating-and-comparing-the-ndvi-evolution-over-plots-that-have-been-subjected-to-ssm-practices-against-control-plots-with-a-sentinel-product" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following section presents a step by step guide to derive Sentinel-2 based spectral images to quantify and compare changes in NDVI values linked to SSM for two plots (one with SSM practices, and one without). In this case a Sentinel product is suggested due to its finer resolution (10 m). The Sentinel-2 mission started in 2015, meaning that for this example images from 2015 to 2020 will be selected. In the provided example we will be comparing two paddocks with contrasting management from 2010, within a 40 hectares project:</p>
<ul>
<li>A grazing paddock (1 ha) with a degraded tropical pasture (Business as usual, BAU)</li>
<li>A paddock (1 ha) with a silvopastoral management, combining improved grass species, shrubs like Leucaena and trees like Glicirida to provide forage during the dry season (Sustainable Soil Management, SSM)</li>
</ul>
<div id="step-1-delineate-two-areas-for-comparison-in-gee" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Step 1 | Delineate two areas for comparison in GEE<a href="#step-1-delineate-two-areas-for-comparison-in-gee" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Draw two geometries directly into GEE using the Geometry Tools. Add a first geometry then click on + new Layer and draw a second one (Figure 11).
Finally, change the geometry names to SSM and Control (Figure 12). Lines 20 and 21 of the provided script can be modified to change the names displayed in the output graph.</p>
<div class="figure">
<img src="images/fig11.png" alt="" />
<p class="caption">Figure 11 Adding multiple layers.</p>
</div>
<div class="figure">
<img src="images/fig12.png" alt="" />
<p class="caption">Figure 12 Correct geometry names.</p>
</div>
</div>
<div id="step-2-copy-paste-and-run-the-provided-scripts-into-gee-1" class="section level3 hasAnchor" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Step 2 | Copy, paste and run the provided scripts into GEE<a href="#step-2-copy-paste-and-run-the-provided-scripts-into-gee-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once the two geometries have been created in GEE and renamed to “SSM” and “Control”, the following script can be copied, pasted and runed into GEE without any modification. The script was designed to provide the following outputs for the AOI:</p>
<ul>
<li>Plot comparison of median NDVI values (two per month) over a specified time period that can be exported as a table and/or graph</li>
<li>The selected NDVI images</li>
<li>A chart comparing mean yearly NDVI values for the SSM and the control plot
To execute the script, copy the provided script below (Script 2) in its entirety, paste it into the code editor and click on Run.</li>
</ul>
</div>
<div id="script-2-ndvi-trend-comparison-over-two-plots-with-sentinel" class="section level3 hasAnchor" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> <strong>Script 2: NDVI trend comparison over two plots with Sentinel</strong><a href="#script-2-ndvi-trend-comparison-over-two-plots-with-sentinel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++// </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Script 2: NDVI trend comparison over two plots</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">// with Sentinel</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">// SSM-Prtocol 08/03/21</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">// This script was created by the GSP-Secretariat</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Authors: Luciano E. Di Paolo, Guillermo E. Peralta, Isabel Luotto</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Find out more about the Global Soil Partnership:</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">// http://www.fao.org/global-soil-partnership/en/ </span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++//</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Make a list of Features. </span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Draw the geometries that represent the plots to analyze (in this case SSM and Control).</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Remember to add a geometry to represent the &quot;optimal&quot; or &quot;reference&quot; area. </span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">//Create a feature list out of the drawn geometries</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> featList <span class="op">=</span> [</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Feature</span>(SSM<span class="op">,</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;SSM&#39;</span>})<span class="op">,</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Feature</span>(Control<span class="op">,</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Control&#39;</span>})</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> featColl <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(featList)<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(featColl)<span class="op">;</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">//SENTINEL 2</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">// This example uses the Sentinel-2 QA band to cloud mask</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co">// the collection.  The Sentinel-2 cloud flags are less</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">// selective, so the collection is also pre-filtered by the</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">// CLOUDY_PIXEL_PERCENTAGE flag, to use only relatively</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">// cloud-free granule.</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">// Function to mask clouds using the Sentinel-2 QA band.</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskS2clouds</span>(image) {</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;QA60&#39;</span>)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bits 10 and 11 are clouds and cirrus, respectively.</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cirrusBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">11</span><span class="op">;</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">and</span>(</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>             qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cirrusBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the masked and scaled data, without the QA bands.</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;B.*&quot;</span>)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&quot;system:time_start&quot;</span>])</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="co">// Select images with the cloud mask</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> filteredCollectionS2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2&#39;</span>)</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filterBounds</span>(featColl)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select the years to perform the analysis</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">2015</span><span class="op">,</span><span class="dv">2020</span><span class="op">,</span><span class="st">&#39;year&#39;</span>))</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Select the months to perform the analysis</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">1</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="st">&#39;month&#39;</span>))</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">20</span>))</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(maskS2clouds)<span class="op">;</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="co">// Define the NDVI function</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> addNDVI <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>]))<span class="op">;</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="co">//Add indices to Image Collection</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="co">// (this can be used as placeholder for other indices)</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ImColl <span class="op">=</span> filteredCollectionS2<span class="op">.</span><span class="fu">map</span>(addNDVI)<span class="op">;</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="co">// Select the median of each image</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> median <span class="op">=</span> ImColl<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ImColl<span class="op">,</span><span class="st">&quot;Image Collection&quot;</span>)<span class="op">;</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="co">// Show temporal median image of NDVI</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(featColl<span class="op">,</span>{<span class="st">&#39;bands&#39;</span><span class="op">:</span> [<span class="st">&#39;nd&#39;</span>]<span class="op">,</span><span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;palette&quot;</span><span class="op">:</span><span class="st">&quot;FFFFFF, CE7E45, DF923D, F1B555, FCD163, 99B718, 74A901, 66A000, 529400, 3E8601, 207401, 056201, 004C00, 023B01, 012E01, 011D01, 011301&quot;</span>}<span class="op">,</span> <span class="st">&quot;NDVI temporal Median&quot;</span>)<span class="op">;</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a time series chart.</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> plotNDVI <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">seriesByRegion</span>(ImColl<span class="op">,</span> featColl<span class="op">,</span>ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;nd&#39;</span><span class="op">,</span><span class="dv">20</span><span class="op">,</span><span class="st">&#39;system:time_start&#39;</span><span class="op">,</span><span class="st">&#39;name&#39;</span>)</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">setChartType</span>(<span class="st">&#39;LineChart&#39;</span>)<span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>                <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Normalize Difference Vegetation Index &#39;</span><span class="op">,</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Date&#39;</span>}<span class="op">,</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>                <span class="dt">vAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;NDVI&#39;</span>}</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="co">// Display.</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plotNDVI)<span class="op">;</span></span></code></pre></div>
</div>
<div id="step-3-export-and-test-for-significant-differences" class="section level3 hasAnchor" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Step 3 | Export and test for significant differences<a href="#step-3-export-and-test-for-significant-differences" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The graph and accompanying data can be viewed and exported from the console as shown in Step 3 of section 3.1.1. A short R script is provided as an example on how to test for the significance of the differences highlighted in the output GEE chart (Figure 13) (Script 2.1).</p>
<div class="figure">
<img src="images/fig13.png" alt="" />
<p class="caption">Figure 13 Example GEE output of a chart showing the median NDVI trend of two plots.</p>
</div>
</div>
<div id="script-2.1-example-of-potential-data-visualization-with-the-output-csv-file-with-a-one-way-anova-in-r." class="section level3 hasAnchor" number="1.2.5">
<h3><span class="header-section-number">1.2.5</span> <strong>Script 2.1 Example of potential data visualization with the output csv file with a one-way Anova in R.</strong><a href="#script-2.1-example-of-potential-data-visualization-with-the-output-csv-file-with-a-one-way-anova-in-r." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define a path to the file </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>wd <span class="ot">&lt;-</span> <span class="st">&quot;C:/Path/Example_data&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the path to define the working directory</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(wd)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#load the data</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;ee-chart.csv&quot;</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Run a one-way ANOVA</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>anova <span class="ot">&lt;-</span> <span class="fu">aov</span>(SSM <span class="sc">~</span> Control, <span class="at">data=</span>data)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Check if there&#39;s a significant effect</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova) </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Extract p-value</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>pvalue <span class="ot">&lt;-</span><span class="fu">summary</span>(anova)[[<span class="dv">1</span>]][[<span class="st">&quot;Pr(&gt;F)&quot;</span>]]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>pvalue <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pvalue <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="st">&quot;p &lt; 0.01&quot;</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">ifelse</span>(pvalue <span class="sc">&gt;</span> <span class="fl">0.01</span> <span class="sc">&amp;</span> pvalue <span class="sc">&lt;</span> <span class="fl">0.05</span>, </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;p &lt; 0.05&quot;</span>, <span class="st">&quot;Not significant&quot;</span>))</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a boxplot with the p-value as annotation</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(data<span class="sc">$</span>SSM , data<span class="sc">$</span>Control, <span class="at">frame =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;SSM&quot;</span>, <span class="st">&quot;Control&quot;</span>), <span class="at">ylab =</span> <span class="st">&quot;NDVI series (2015-2020)&quot;</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(pvalue, <span class="at">side=</span><span class="dv">3</span>)</span></code></pre></div>
</div>
</div>
<div id="estimating-vegetation-cover-ratios-to-compare-the-effects-of-ssm" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Estimating vegetation cover ratios to compare the effects of SSM<a href="#estimating-vegetation-cover-ratios-to-compare-the-effects-of-ssm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Following the same steps explained in the section 3.1.1 and 3.1.2 an aggregated vegetation cover trend can be derived by estimating the mean yearly ratio of images over a certain threshold (e.g. NDVI &gt; 0.3) to compare the performance of two plots using a Sentinel product (Script 3). Aggregating the NDVI values represents a useful strategy to further highlight trends and evaluate differences linked to different management practices.
With the following script a chart comparing the yearly vegetation cover ratio from 2017 to 2020 can be created.</p>
<div id="script-3-vegetation-cover-ratio-trend-comparison-over-two-plots-with-sentinel" class="section level3 hasAnchor" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> <strong>Script 3: Vegetation cover ratio trend comparison over two plots with Sentinel</strong><a href="#script-3-vegetation-cover-ratio-trend-comparison-over-two-plots-with-sentinel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++// </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Script 3: NDVI trend comparison over two plots</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">// with Sentinel (2017-2020)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">// SSM-Prtocol 08/03/21</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">// This script was created by the GSP-Secretariat</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Authors: Luciano E Di Paolo, Guillermo E Peralta, Isabel Luotto</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Find out more about the Global Soil Partnership:</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">// http://www.fao.org/global-soil-partnership/en/ </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++//</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Make a list of Features. </span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Draw the geometries that represents the plots to analyze( in this case L01 and L02).</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Remember to add a geometry to represent the &quot;optimal&quot; or &quot;reference&quot; area. </span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">//After drawing the geometries, change the names after the &quot;name&quot; variable. </span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> featList <span class="op">=</span> [</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Feature</span>(Control<span class="op">,</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Control&#39;</span>})<span class="op">,</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Feature</span>(SSM<span class="op">,</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;SSM&#39;</span>})</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> featColl <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(featList)<span class="op">;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(featColl)<span class="op">;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co">//SENTINEL 2</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">// This example uses the Sentinel-2 QA band to cloud mask</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co">// the collection.  The Sentinel-2 cloud flags are less</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co">// selective, so the collection is also pre-filtered by the</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co">// CLOUDY_PIXEL_PERCENTAGE flag, to use only relatively</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co">// cloud-free granule.</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="co">// Function to mask clouds using the Sentinel-2 QA band.</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskS2clouds</span>(image) {</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;QA60&#39;</span>)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bits 10 and 11 are clouds and cirrus, respectively.</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cirrusBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">11</span><span class="op">;</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">and</span>(</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>             qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cirrusBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the masked and scaled data, without the QA bands.</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;B.*&quot;</span>)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&quot;system:time_start&quot;</span>])</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="co">// Select images from a collection with a silder.</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> filteredCollectionS2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2&#39;</span>)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filterBounds</span>(featColl)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select the years to perform the analysis</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">2015</span><span class="op">,</span><span class="dv">2020</span><span class="op">,</span><span class="st">&#39;year&#39;</span>))</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Select the months to perform the analysis</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">1</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="st">&#39;month&#39;</span>))</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">20</span>))</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(maskS2clouds)<span class="op">;</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="co">// NDVI function</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> addNDVI <span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span> <span class="st">&#39;B4&#39;</span>]))<span class="op">;</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="co">// Add indexs to Image Collection</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ImColl <span class="op">=</span> filteredCollectionS2<span class="op">.</span><span class="fu">map</span>(addNDVI)<span class="op">;</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> median <span class="op">=</span> ImColl<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Area_temp_median <span class="op">=</span> median<span class="op">.</span><span class="fu">clip</span>(featColl)<span class="op">;</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="co">//var plots_temp_median = Area_temp_median.clip(featColl);</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ImColl<span class="op">,</span><span class="st">&quot;Image Collection&quot;</span>)<span class="op">;</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a><span class="co">// Show temporal median image of NDVI</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(Area_temp_median<span class="op">,</span>{<span class="st">&#39;bands&#39;</span><span class="op">:</span> [<span class="st">&#39;nd&#39;</span>]<span class="op">,</span><span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;palette&quot;</span><span class="op">:</span><span class="st">&quot;FFFFFF, CE7E45, DF923D, F1B555, FCD163, 99B718, 74A901, 66A000, 529400, 3E8601, 207401, 056201, 004C00, 023B01, 012E01, 011D01, 011301&quot;</span>}<span class="op">,</span> <span class="st">&quot;NDVI temporal Median&quot;</span>)<span class="op">;</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a><span class="co">// Show the total number of images in the collection</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndColl<span class="op">=</span>ImColl<span class="op">.</span><span class="fu">select</span>([<span class="st">&#39;nd&#39;</span>])<span class="op">;</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Total number of NDVI images: &#39;</span><span class="op">,</span> ndColl<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="co">// Define a mask using a threshold of 0.</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mask_ndvi<span class="op">=</span> <span class="kw">function</span>(image) {</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;nd&#39;</span>)<span class="op">.</span><span class="fu">gt</span>(<span class="fl">0.3</span>)<span class="op">;</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span>}</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a><span class="co">// NDVI PROPORTION 2017</span></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ImColl2017 <span class="op">=</span> ImColl<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">2017</span><span class="op">,</span><span class="dv">2017</span><span class="op">,</span><span class="st">&#39;year&#39;</span>))<span class="op">;</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndColl2017<span class="op">=</span>ImColl2017<span class="op">.</span><span class="fu">select</span>([<span class="st">&#39;nd&#39;</span>])<span class="op">;</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a><span class="co">//Apply the mask to the BSI Collection</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndCollmasked17<span class="op">=</span>ndColl2017<span class="op">.</span><span class="fu">map</span>(mask_ndvi)<span class="op">;</span> </span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a><span class="co">// Count the number of times that the threshold is surpased</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndCollmasked_nn17<span class="op">=</span>ndCollmasked17<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a><span class="co">// Count the number of bsi images</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndColl_nn17<span class="op">=</span>ndColl2017<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the proportion of times the bsi is greater than the threshold</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_2017<span class="op">=</span> ndCollmasked_nn17<span class="op">.</span><span class="fu">divide</span>(ndColl_nn17)<span class="op">;</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a><span class="co">// Cut the BSI proportion by the area of interest</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_rec2017 <span class="op">=</span> prop_ndvi_2017<span class="op">.</span><span class="fu">clip</span>(featColl)<span class="op">;</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_rec2017 <span class="op">=</span> prop_ndvi_rec2017<span class="op">.</span><span class="fu">set</span>({</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>  <span class="dt">year</span><span class="op">:</span> <span class="st">&quot;2017&quot;</span></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>prop_ndvi_rec2017 <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(prop_ndvi_rec2017)</span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(prop_ndvi_rec2017<span class="op">,</span>{<span class="st">&#39;bands&#39;</span><span class="op">:</span> [<span class="st">&#39;nd_count&#39;</span>]<span class="op">,</span><span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span>[<span class="st">&#39;011301&#39;</span><span class="op">,</span><span class="st">&#39;FFFFFF&#39;</span>]}<span class="op">,</span> <span class="st">&quot;NDVI prop 2017&quot;</span>)<span class="op">;</span></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a><span class="co">// NDVI PROPORTION 2018</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ImColl2018 <span class="op">=</span> ImColl<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">2018</span><span class="op">,</span><span class="dv">2018</span><span class="op">,</span><span class="st">&#39;year&#39;</span>))<span class="op">;</span></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndColl2018<span class="op">=</span>ImColl2018<span class="op">.</span><span class="fu">select</span>([<span class="st">&#39;nd&#39;</span>])<span class="op">;</span></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a><span class="co">//Apply the mask to the BSI Collection</span></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndCollmasked18<span class="op">=</span>ndColl2018<span class="op">.</span><span class="fu">map</span>(mask_ndvi)<span class="op">;</span> </span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a><span class="co">// Count the number of times that the threshold is surpased</span></span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndCollmasked_nn18<span class="op">=</span>ndCollmasked18<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a><span class="co">// Count the number of bsi images</span></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndColl_nn18<span class="op">=</span>ndColl2018<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the proportion of times the bsi is greater than the threshold</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_2018<span class="op">=</span> ndCollmasked_nn18<span class="op">.</span><span class="fu">divide</span>(ndColl_nn18)<span class="op">;</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a><span class="co">// Cut the BSI proportion by the area of interest</span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_rec2018 <span class="op">=</span> prop_ndvi_2018<span class="op">.</span><span class="fu">clip</span>(featColl)<span class="op">;</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(prop_ndvi_rec2018<span class="op">,</span>{<span class="st">&#39;bands&#39;</span><span class="op">:</span> [<span class="st">&#39;nd_count&#39;</span>]<span class="op">,</span><span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span>[<span class="st">&#39;011301&#39;</span><span class="op">,</span><span class="st">&#39;FFFFFF&#39;</span>]}<span class="op">,</span> <span class="st">&quot;NDVI prop 2018&quot;</span>)<span class="op">;</span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_rec2018 <span class="op">=</span> prop_ndvi_rec2018<span class="op">.</span><span class="fu">set</span>({</span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>  <span class="dt">year</span><span class="op">:</span> <span class="st">&quot;2018&quot;</span></span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>prop_ndvi_rec2018 <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(prop_ndvi_rec2018)<span class="op">;</span></span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a><span class="co">// NDVI PROPORTION 2019</span></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ImColl2019 <span class="op">=</span> ImColl<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">2019</span><span class="op">,</span><span class="dv">2019</span><span class="op">,</span><span class="st">&#39;year&#39;</span>))<span class="op">;</span></span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndColl2019<span class="op">=</span>ImColl2019<span class="op">.</span><span class="fu">select</span>([<span class="st">&#39;nd&#39;</span>])<span class="op">;</span></span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a><span class="co">//Apply the mask to the BSI Collection</span></span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndCollmasked19<span class="op">=</span>ndColl2019<span class="op">.</span><span class="fu">map</span>(mask_ndvi)<span class="op">;</span> </span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a><span class="co">// Count the number of times that the threshold is surpased</span></span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndCollmasked_nn19<span class="op">=</span>ndCollmasked19<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a><span class="co">// Count the number of bsi images</span></span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndColl_nn19<span class="op">=</span>ndColl2019<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the proportion of times the bsi is greater than the threshold</span></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_2019<span class="op">=</span> ndCollmasked_nn19<span class="op">.</span><span class="fu">divide</span>(ndColl_nn19)<span class="op">;</span></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a><span class="co">// Cut the BSI proportion by the area of interest</span></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_rec2019 <span class="op">=</span> prop_ndvi_2019<span class="op">.</span><span class="fu">clip</span>(featColl)<span class="op">;</span></span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(prop_ndvi_rec2019<span class="op">,</span>{<span class="st">&#39;bands&#39;</span><span class="op">:</span> [<span class="st">&#39;nd_count&#39;</span>]<span class="op">,</span><span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span>[<span class="st">&#39;011301&#39;</span><span class="op">,</span><span class="st">&#39;FFFFFF&#39;</span>]}<span class="op">,</span> <span class="st">&quot;NDVI prop 2019&quot;</span>)<span class="op">;</span></span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_rec2019 <span class="op">=</span> prop_ndvi_rec2019<span class="op">.</span><span class="fu">set</span>({</span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>  <span class="dt">year</span><span class="op">:</span> <span class="st">&quot;2019&quot;</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>prop_ndvi_rec2019 <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(prop_ndvi_rec2019)<span class="op">;</span></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a><span class="co">// NDVI PROPORTION 2020</span></span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ImColl2020 <span class="op">=</span> ImColl<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">2020</span><span class="op">,</span><span class="dv">2020</span><span class="op">,</span><span class="st">&#39;year&#39;</span>))<span class="op">;</span></span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndColl2020<span class="op">=</span>ImColl2020<span class="op">.</span><span class="fu">select</span>([<span class="st">&#39;nd&#39;</span>])<span class="op">;</span></span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a><span class="co">//Apply the mask to the BSI Collection</span></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndCollmasked20<span class="op">=</span>ndColl2020<span class="op">.</span><span class="fu">map</span>(mask_ndvi)<span class="op">;</span> </span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a><span class="co">// Count the number of times that the threshold is surpased</span></span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndCollmasked_nn20<span class="op">=</span>ndCollmasked20<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a><span class="co">// Count the number of bsi images</span></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndColl_nn20<span class="op">=</span>ndColl2020<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">count</span>())<span class="op">;</span></span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the proportion of times the bsi is greater than the threshold</span></span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_2020<span class="op">=</span> ndCollmasked_nn20<span class="op">.</span><span class="fu">divide</span>(ndColl_nn20)<span class="op">;</span></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a><span class="co">// Cut the BSI proportion by the area of interest</span></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_rec2020 <span class="op">=</span> prop_ndvi_2020<span class="op">.</span><span class="fu">clip</span>(featColl)<span class="op">;</span></span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(prop_ndvi_rec2020<span class="op">,</span>{<span class="st">&#39;bands&#39;</span><span class="op">:</span> [<span class="st">&#39;nd_count&#39;</span>]<span class="op">,</span><span class="dt">min</span><span class="op">:</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span>[<span class="st">&#39;011301&#39;</span><span class="op">,</span><span class="st">&#39;FFFFFF&#39;</span>]}<span class="op">,</span> <span class="st">&quot;NDVI prop 2020&quot;</span>)<span class="op">;</span></span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> prop_ndvi_rec2020 <span class="op">=</span> prop_ndvi_rec2020<span class="op">.</span><span class="fu">set</span>({</span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>  <span class="dt">year</span><span class="op">:</span> <span class="st">&quot;2020&quot;</span></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>prop_ndvi_rec2020 <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(prop_ndvi_rec2020)<span class="op">;</span></span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a new Image Collection</span></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> NDVIpropColl1720 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>([prop_ndvi_rec2017<span class="op">,</span> prop_ndvi_rec2018<span class="op">,</span>prop_ndvi_rec2019<span class="op">,</span>prop_ndvi_rec2020])<span class="op">;</span></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;NDVI prop collection: &#39;</span><span class="op">,</span> NDVIpropColl1720 )<span class="op">;</span></span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a time series chart.</span></span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> plotprop <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">seriesByRegion</span>(NDVIpropColl1720<span class="op">,</span> featColl<span class="op">,</span>ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;nd_count&#39;</span><span class="op">,</span><span class="dv">20</span><span class="op">,</span><span class="st">&#39;year&#39;</span><span class="op">,</span><span class="st">&#39;name&#39;</span>)</span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">setChartType</span>(<span class="st">&#39;LineChart&#39;</span>)<span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>                <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Proportion of images with NDVI&gt;0.3&#39;</span><span class="op">,</span></span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Date&#39;</span>}<span class="op">,</span></span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a>                <span class="dt">vAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;NDVI&gt;0.3/count(NDVI)&#39;</span>}</span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a><span class="co">// Display.</span></span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plotprop)<span class="op">;</span></span></code></pre></div>
</div>
</div>
<div id="assessing-ssm-through-bare-soil-index-bsi" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Assessing SSM through Bare Soil Index (BSI)<a href="#assessing-ssm-through-bare-soil-index-bsi" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Following the same steps presented in the previous sections the Bare Soil Index trend can be derived either for one area that encompasses the whole project (Script 4) using a MODIS product or to compare the performance a plot with SSM practices against a control plot (Script 6) using a Sentinel product.</p>
<div id="script-4-bare-soil-index-trend-comparison-for-the-whole-area-using-modis" class="section level3 hasAnchor" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> <strong>Script 4: Bare Soil Index trend comparison for the whole area using MODIS</strong><a href="#script-4-bare-soil-index-trend-comparison-for-the-whole-area-using-modis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++// </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Script 5: BSI trend over a larger area </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">// with MODIS</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">// SSM-Prtocol 08/03/21</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">// This script was created by the GSP-Secretariat</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Find out more about the Global Soil Partnership:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">// http://www.fao.org/global-soil-partnership/en/ </span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++//</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Area of Interest</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(area<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;Area of interest&#39;</span>)<span class="op">;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">// MODIS MOD09A1 product</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dataset <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;MODIS/006/MOD09A1&#39;</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">filterBounds</span>(area)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select the years to perform the analysis</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">2015</span><span class="op">,</span><span class="dv">2020</span><span class="op">,</span><span class="st">&#39;year&#39;</span>))</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Select the months to perform the analysis</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">1</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="st">&#39;month&#39;</span>))<span class="op">;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">//Bare Soil Index (BSI):</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">// (BSI) </span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">//Fórmula del BSI = ((Red+SWIR2) - (NIR+Blue)) / ((Red+SWIR2) + (NIR+Blue))</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">// BSI (Modis) = (B1 + B7) - (B2 + B3) / (B1 + B7) + (B2 + B3)</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> addBSI <span class="op">=</span> <span class="kw">function</span>(image){</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span> (image<span class="op">.</span><span class="fu">expression</span>(</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;bsi=((b1 + b7)-(b2+b3))/((b1 + b7)+(b2+b3))&#39;</span><span class="op">,</span> {</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b7&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;sur_refl_b07&#39;</span>)<span class="op">,</span> <span class="co">// SWIR2</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b1&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;sur_refl_b01&#39;</span>)<span class="op">,</span> <span class="co">// Red</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b3&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;sur_refl_b03&#39;</span>)<span class="op">,</span> <span class="co">//BLUE</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b2&#39;</span><span class="op">:</span>image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;sur_refl_b02&#39;</span>)}))<span class="op">;</span><span class="co">//NIR</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="co">// Add indexs to Image Collection</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ImColl <span class="op">=</span> dataset<span class="op">.</span><span class="fu">map</span>(addBSI)<span class="op">;</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the median of the time series of the indexes</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> median <span class="op">=</span> ImColl<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Area_temp_median <span class="op">=</span> median<span class="op">.</span><span class="fu">clip</span>(area)<span class="op">;</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ImColl<span class="op">,</span><span class="st">&quot;Image Collection&quot;</span>)<span class="op">;</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="co">// Show the total number of images in the collection</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> bsiColl<span class="op">=</span>ImColl<span class="op">.</span><span class="fu">select</span>([<span class="st">&#39;bsi&#39;</span>])<span class="op">;</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Total number of BSI images: &#39;</span><span class="op">,</span> bsiColl<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a time series chart.</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> plotBSI <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">seriesByRegion</span>(ImColl<span class="op">,</span> area<span class="op">,</span>ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;bsi&#39;</span><span class="op">,</span><span class="dv">500</span><span class="op">,</span><span class="st">&#39;system:time_start&#39;</span><span class="op">,</span><span class="st">&#39;name&#39;</span>)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">setChartType</span>(<span class="st">&#39;LineChart&#39;</span>)<span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>                <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Bare Soil Index&#39;</span><span class="op">,</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Date&#39;</span>}<span class="op">,</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>                <span class="dt">vAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;BSI&#39;</span>}</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="co">// Display.</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plotBSI)<span class="op">;</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a><span class="co">// Display.</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plotBSI)<span class="op">;</span></span></code></pre></div>
</div>
<div id="script-5-bare-soil-index-trend-comparison-over-two-plots-with-sentinel" class="section level3 hasAnchor" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> <strong>Script 5: Bare Soil Index trend comparison over two plots with Sentinel</strong><a href="#script-5-bare-soil-index-trend-comparison-over-two-plots-with-sentinel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++// </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Script 5: BSI trend comparison over two plots</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">// with Sentinel</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">// SSM-Prtocol 08/03/21</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">// This script was created by the GSP-Secretariat</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Find out more about the Global Soil Partnership:</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">// http://www.fao.org/global-soil-partnership/en/ </span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++//</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Make a list of Features. </span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Draw the geometries that represents the plots to analyze (in this case SSM and Control).</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Remember to add a geometry to represent the &quot;optimal&quot; or &quot;reference&quot; area. </span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">//Create a feature list out of the drawn geometries</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> featList <span class="op">=</span> [</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Feature</span>(SSM<span class="op">,</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;SSM&#39;</span>})<span class="op">,</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Feature</span>(Control<span class="op">,</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Control&#39;</span>})</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> featColl <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(featList)<span class="op">;</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(featColl)<span class="op">;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co">//SENTINEL 2</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co">// This example uses the Sentinel-2 QA band to cloud mask</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co">// the collection.  The Sentinel-2 cloud flags are less</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co">// selective, so the collection is also pre-filtered by the</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co">// CLOUDY_PIXEL_PERCENTAGE flag, to use only relatively</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co">// cloud-free granule.</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="co">// Function to mask clouds using the Sentinel-2 QA band.</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskS2clouds</span>(image) {</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;QA60&#39;</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bits 10 and 11 are clouds and cirrus, respectively.</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cirrusBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">11</span><span class="op">;</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">and</span>(</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>             qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cirrusBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the masked and scaled data, without the QA bands.</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;B.*&quot;</span>)</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&quot;system:time_start&quot;</span>])</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="co">// Select images from a collection with a silder.</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> filteredCollectionS2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2&#39;</span>)</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filterBounds</span>(featColl)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select the years to perform the analysis</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">2015</span><span class="op">,</span><span class="dv">2020</span><span class="op">,</span><span class="st">&#39;year&#39;</span>))</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Select the months to perform the analysis</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">1</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="st">&#39;month&#39;</span>))</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">20</span>))</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(maskS2clouds)<span class="op">;</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="co">//Bare Soil Index (BSI):</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="co">// (BSI) (GU, 2019).</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="co">//Fórmula del BSI = ((Red+SWIR2) - (NIR+Blue)) / ((Red+SWIR2) + (NIR+Blue))</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="co">// BSI (Sentinel 2) = (B12 + B4) - (B8 + B2) / (B12 + B4) + (B8 + B2)</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> addBSI <span class="op">=</span> <span class="kw">function</span>(image){</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span> (image<span class="op">.</span><span class="fu">expression</span>(</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;bsi=((b12 + b4)-(b8+b2))/((b12 + b4)+(b8+b2))&#39;</span><span class="op">,</span> {</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b12&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B12&#39;</span>)<span class="op">,</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b4&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B4&#39;</span>)<span class="op">,</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b8&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B8&#39;</span>)<span class="op">,</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b2&#39;</span><span class="op">:</span>image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B2&#39;</span>)}))<span class="op">;</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="co">// Add indexs to Image Collection</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ImColl <span class="op">=</span> filteredCollectionS2<span class="op">.</span><span class="fu">map</span>(addBSI)<span class="op">;</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> median <span class="op">=</span> ImColl<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Area_temp_median <span class="op">=</span> median<span class="op">.</span><span class="fu">clip</span>(featColl)<span class="op">;</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a><span class="co">//var plots_temp_median = Area_temp_median.clip(featColl);</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ImColl<span class="op">,</span><span class="st">&quot;Image Collection&quot;</span>)<span class="op">;</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="co">// Show the total number of images in the collection</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> bsiColl<span class="op">=</span>ImColl<span class="op">.</span><span class="fu">select</span>([<span class="st">&#39;bsi&#39;</span>])<span class="op">;</span></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Total number of BSI images: &#39;</span><span class="op">,</span> bsiColl<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(Area_temp_median<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> Area_temp_median<span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;bsi&quot;</span>)<span class="op">,</span></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;working_directory&quot;</span><span class="op">,</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;BSI_median_S2_m01-m012_15-20&#39;</span><span class="op">,</span> </span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span>featColl<span class="op">,</span></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>          <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a time series chart.</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> plotBSI <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">seriesByRegion</span>(ImColl<span class="op">,</span> featColl<span class="op">,</span>ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;bsi&#39;</span><span class="op">,</span><span class="dv">20</span><span class="op">,</span><span class="st">&#39;system:time_start&#39;</span><span class="op">,</span><span class="st">&#39;name&#39;</span>)</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">setChartType</span>(<span class="st">&#39;LineChart&#39;</span>)<span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>                <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Bare Soil Index&#39;</span><span class="op">,</span></span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Date&#39;</span>}<span class="op">,</span></span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>                <span class="dt">vAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;BSI&#39;</span>}</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a><span class="co">// Display.</span></span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plotBSI)<span class="op">;</span></span></code></pre></div>
</div>
</div>
<div id="assessing-ssm-through-the-normalized-difference-water-index-ndwi" class="section level2 hasAnchor" number="1.5">
<h2><span class="header-section-number">1.5</span> Assessing SSM through the Normalized Difference Water Index (NDWI)<a href="#assessing-ssm-through-the-normalized-difference-water-index-ndwi" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Following the same steps presented in the previous sections, the NDWI trend can be derived either for one area that encompasses the whole project (Script 6) using a MODIS product or to compare the performance of a plot with SSM practices against a control plot (Script 7) using a Sentinel product.</p>
<div id="script-6-ndwi-trend-comparison-for-the-whole-area-using-modis" class="section level3 hasAnchor" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> <strong>Script 6: NDWI trend comparison for the whole area using MODIS</strong><a href="#script-6-ndwi-trend-comparison-for-the-whole-area-using-modis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++// </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Script 6: NDWI trend over a larger area </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">// with MODIS</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">// SSM-Prtocol 09/03/21</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">// This script was created by the GSP-Secretariat</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Authors: Luciano E. Di Paolo, Guillermo E. Peralta, Isabel Luotto. </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Find out more about the Global Soil Partnership:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">// http://www.fao.org/global-soil-partnership/en/ </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++//</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Display yout Area of Interest (AOI)</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(area<span class="op">,</span> {}<span class="op">,</span> <span class="st">&#39;Area of interest&#39;</span>)<span class="op">;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">//Zoom to layer</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">//Load images from MODIS MOD09A1 product</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dataset <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;MODIS/006/MOD09A1&#39;</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">filterBounds</span>(area)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select the years to perform the analysis</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">2010</span><span class="op">,</span><span class="dv">2020</span><span class="op">,</span><span class="st">&#39;year&#39;</span>))</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Select the months to perform the analysis</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">1</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="st">&#39;month&#39;</span>))<span class="op">;</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">// NDWI = (NIR - SWIR2) / (NIR + SWIR2)  Gao (1996)</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">// NDWI (Modis) = (B2 - B7) / (B2 + B7)</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> addNDWI <span class="op">=</span> <span class="kw">function</span>(image){</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span> (image<span class="op">.</span><span class="fu">expression</span>(</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;ndwi=(b2 - b7)/(b2 + b7)&#39;</span><span class="op">,</span> {</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b2&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;sur_refl_b02&#39;</span>)<span class="op">,</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b7&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;sur_refl_b07&#39;</span>)}))<span class="op">;</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ImColl <span class="op">=</span> dataset<span class="op">.</span><span class="fu">map</span>(addNDWI)<span class="op">;</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the median of the time series of the indexes</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> median <span class="op">=</span> ImColl<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Area_temp_median <span class="op">=</span> median<span class="op">.</span><span class="fu">clip</span>(area)<span class="op">;</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ImColl<span class="op">,</span><span class="st">&quot;Image Collection&quot;</span>)<span class="op">;</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(Area_temp_median<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> Area_temp_median<span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;ndwi&quot;</span>)<span class="op">,</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;working_directory&quot;</span><span class="op">,</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;NDWI_median_Modis_m01-m012_00-20&#39;</span><span class="op">,</span> </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span>area<span class="op">,</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>          <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a time series chart.</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> plotNDWI <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">seriesByRegion</span>(ImColl<span class="op">,</span> area<span class="op">,</span>ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;ndwi&#39;</span><span class="op">,</span><span class="dv">500</span><span class="op">,</span><span class="st">&#39;system:time_start&#39;</span><span class="op">,</span><span class="st">&#39;name&#39;</span>)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">setChartType</span>(<span class="st">&#39;LineChart&#39;</span>)<span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>                 <span class="dt">trendlines</span><span class="op">:</span> {<span class="dt">type</span><span class="op">:</span> <span class="st">&#39;polynomial&#39;</span><span class="op">,</span> <span class="dv">0</span><span class="op">:</span> {<span class="dt">color</span><span class="op">:</span> <span class="st">&#39;CC0000&#39;</span>}<span class="op">,</span> <span class="dt">visibleInLegend</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">,</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>                <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Mean Normalized Difference Water Index&#39;</span><span class="op">,</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Date&#39;</span>}<span class="op">,</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>                <span class="dt">vAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;NDWI&#39;</span>}</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="co">// Display.</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plotNDWI)<span class="op">;</span></span></code></pre></div>
</div>
<div id="script-7-ndwi-trend-comparison-over-two-plots-with-sentinel" class="section level3 hasAnchor" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> <strong>Script 7: NDWI trend comparison over two plots with Sentinel</strong><a href="#script-7-ndwi-trend-comparison-over-two-plots-with-sentinel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++// </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Script 7: NDWI trend comparison over two plots</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">// with Sentinel</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">// SSM-Prtocol 08/03/21</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">// This script was created by the GSP-Secretariat</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Authors: Luciano E. Di Paolo, Guillermo E. Peralta, Isabel Luotto</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Find out more about the Global Soil Partnership:</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">// http://www.fao.org/global-soil-partnership/en/ </span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">//++++++++++++++++++++++++++++++++++++++++++++++//</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Make a list of Features. </span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Draw the geometries that represent the plots to analyze (in this case SSM and Control).</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Remember to add a geometry to represent the &quot;optimal&quot; or &quot;reference&quot; area. </span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">//Create a feature list out of the drawn geometries</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> featList <span class="op">=</span> [</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Feature</span>(SSM<span class="op">,</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;SSM&#39;</span>})<span class="op">,</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Feature</span>(Control<span class="op">,</span> {<span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Control&#39;</span>})</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> featColl <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(featList)<span class="op">;</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(featColl)<span class="op">;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co">//SENTINEL 2</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co">// This example uses the Sentinel-2 QA band to cloud mask</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co">// the collection.  The Sentinel-2 cloud flags are less</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co">// selective, so the collection is also pre-filtered by the</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co">// CLOUDY_PIXEL_PERCENTAGE flag, to use only relatively</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">// cloud-free granule.</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co">// Function to mask clouds using the Sentinel-2 QA band.</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskS2clouds</span>(image) {</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;QA60&#39;</span>)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bits 10 and 11 are clouds and cirrus, respectively.</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cirrusBitMask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">11</span><span class="op">;</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">and</span>(</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>             qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cirrusBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the masked and scaled data, without the QA bands.</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">.</span><span class="fu">divide</span>(<span class="dv">10000</span>)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;B.*&quot;</span>)</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">copyProperties</span>(image<span class="op">,</span> [<span class="st">&quot;system:time_start&quot;</span>])</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="co">// Select images with the cloud mask</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> filteredCollectionS2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2&#39;</span>)</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filterBounds</span>(featColl)</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Select the years to perform the analysis</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">2015</span><span class="op">,</span><span class="dv">2020</span><span class="op">,</span><span class="st">&#39;year&#39;</span>))</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Select the months to perform the analysis</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">calendarRange</span>(<span class="dv">1</span><span class="op">,</span><span class="dv">12</span><span class="op">,</span><span class="st">&#39;month&#39;</span>))</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span><span class="op">,</span> <span class="dv">20</span>))</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(maskS2clouds)<span class="op">;</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="co">//Add indices to Image Collection</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="co">// (this can be used as placeholder for other indices)</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="co">// NDWI = (NIR - SWIR2) / (NIR + SWIR2) Método de Gao (1996)</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="co">// NDWI (Sentinel 2) = (B8 - b12) / (B12 + B8)</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> addNDWI <span class="op">=</span> <span class="kw">function</span>(image){</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span> (image<span class="op">.</span><span class="fu">expression</span>(</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;ndwi=(b8-b12)/(b12+ b8)&#39;</span><span class="op">,</span> {</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;b12&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B12&#39;</span>)<span class="op">,</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>     <span class="st">&#39;b8&#39;</span><span class="op">:</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B8&#39;</span>)}))<span class="op">;</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ImColl <span class="op">=</span> filteredCollectionS2<span class="op">.</span><span class="fu">map</span>(addNDWI)<span class="op">;</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> median <span class="op">=</span> ImColl<span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Area_temp_median <span class="op">=</span> median<span class="op">.</span><span class="fu">clip</span>(featColl)<span class="op">;</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="co">//var plots_temp_median = Area_temp_median.clip(featColl);</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ImColl<span class="op">,</span><span class="st">&quot;Image Collection&quot;</span>)<span class="op">;</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="co">//Export the images</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> regionJSON <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(Area_temp_median<span class="op">.</span><span class="fu">getInfo</span>())<span class="op">;</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>          <span class="dt">image</span><span class="op">:</span> Area_temp_median<span class="op">.</span><span class="fu">select</span>(<span class="st">&quot;ndwi&quot;</span>)<span class="op">,</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>          <span class="dt">folder</span><span class="op">:</span> <span class="st">&quot;working_directory&quot;</span><span class="op">,</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>          <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;NDWI_median_S2_m01-m012_15-20&#39;</span><span class="op">,</span> </span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>          <span class="dt">scale</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>          <span class="dt">region</span><span class="op">:</span>featColl<span class="op">,</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>          <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e9</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a time series chart.</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> plotNDWI <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">seriesByRegion</span>(ImColl<span class="op">,</span> featColl<span class="op">,</span>ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;ndwi&#39;</span><span class="op">,</span><span class="dv">20</span><span class="op">,</span><span class="st">&#39;system:time_start&#39;</span><span class="op">,</span><span class="st">&#39;name&#39;</span>)</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>              <span class="op">.</span><span class="fu">setChartType</span>(<span class="st">&#39;LineChart&#39;</span>)<span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>                <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Normalize Difference Water Index&#39;</span><span class="op">,</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Date&#39;</span>}<span class="op">,</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>                <span class="dt">vAxis</span><span class="op">:</span> {<span class="dt">title</span><span class="op">:</span> <span class="st">&#39;NDWI&#39;</span>}</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a><span class="co">// Display.</span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plotNDWI)<span class="op">;</span></span></code></pre></div>
</div>
</div>
<div id="presenting-and-explaining-the-gee-results-to-assess-ssm" class="section level2 hasAnchor" number="1.6">
<h2><span class="header-section-number">1.6</span> Presenting and explaining the GEE results to assess SSM<a href="#presenting-and-explaining-the-gee-results-to-assess-ssm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following section presents the results obtained from Google Earth Engine and provides an overview of potential conclusions that can be drawn in regards to the example project area. The main objective of this section is to provide an example analysis based on the suggested indices (NDVI, BSI and NDWI).</p>
<div id="example-project-area" class="section level3 hasAnchor" number="1.6.1">
<h3><span class="header-section-number">1.6.1</span> Example Project Area<a href="#example-project-area" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The example area is located in San Juan Nepomuceno, a town and municipality located in the Bolívar Department of northern Colombia. The project started in 2008 and was implemented on an area of 42.4 ha. The example area has undergone change in terms of land use (extensive pasture to a mosaic of silvopastoral areas and perennial crops). The overall greening of the entire project area (Figure 14) was assessed using MODIS based images, while a more detailed comparison between two plots (Figure 15) to assess the effect of silvopastoralism using Sentinel-2 images was performed.
The effect of silvopastoralism was assessed by comparing two paddocks with contrasting management from 2010:</p>
<ul>
<li>A grazing paddock (1 ha) with a degraded tropical pasture (Business as usual, BAU)</li>
<li>A paddock (1 ha) with a silvopastoral management, combining improved grass species, shrubs like Leucaena and trees like Glicirida to provide forage during the dry season (Sustainable Soil Management, SSM)</li>
</ul>
</div>
<div id="interpreting-the-results" class="section level3 hasAnchor" number="1.6.2">
<h3><span class="header-section-number">1.6.2</span> Interpreting the results<a href="#interpreting-the-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once the generated dataset is downloaded (e.g. to a spreadsheet format, Step 3, Section 3.1), the data can be analysed in the preferred statistical or graph software (e.g. microsoft Excel, R, Graphpad prism, etc.) to assess The general trend of the project and compare the effects of management practices.
In this example, the implementation of silvopastoral systems, improved grazing management, and water catchment surfaces among other practices, increased the overall productivity and vegetation cover of the whole farm. Since the implementation of the project in 2008, there has been a positive trend in NDVI annual averages (Figure 14), as reflected by the MODIS long-term historical products.</p>
<div class="figure">
<img src="images/fig14.png" alt="" />
<p class="caption">Figure 14 Annual NDVI trend sinde the implementation of the project</p>
</div>
<p>This can be seen with greater detail , when we compare the results of NDVI, BSI and NDWI for the 2015-2021 series in the two contrasting managements mentioned above. The area with the silvopastoral system (SSM) showed greater NDVI average values (Figure 15a) than the area under extensive grazing (BAU), implying a greater vegetation cover and photosynthetic activity through the analysed period. On the other hand, by providing a greater vegetation cover through the year, SSM practices reduced soil exposure, as shown in Figure 15b. The BSI was greater under BAU practices, with average values closer to the threshold for bare soils/completely exposed soil surfaces (~ 0-0.08; Mzid et al., 2021). SSM practices may have also increased water infiltration and reduced surface runoff, improving water availability for vegetation growth. As shown in Figure 15c, a greater NDWI (i.e. lower water stress) in SSM practices may be reflecting this effect.</p>
<p><img src="images/fig15.png" alt="Figure 15 Normalized Difference in Vegetation Index (NDVI; a); Bare Soil Index (BSI, b) and Normalized Difference WaterIndex (c) obtained from the 2015-2021 series (Sentinel Products), under Sustainable Soil Management (SSM) and Business As Usual (BAU) practices. Average values and P values paired t-tests are shown for each index." />
A year to year analysis shows that since 2015, SSM practices increased vegetation cover (higher annual NDVI values, Figure 16a), reduced soil exposure (lower BSI values, Figure 16b) and reduced water stress (higher NDWI values, Figure 16c) compared to BAU practices. Year to year variations correspond to climatic effects, but overall, the introduction of SSM practices showed clear and distinguishable effects through the entire period.</p>
<div class="figure">
<img src="images/fig16.png" alt="" />
<p class="caption">Figure 16 Annual evolution of the Normalized Difference in Vegetation Index (NDVI; a); Bare Soil Index (BSI, b) and Normalized Difference WaterIndex (c) in the 2015-2021 series (Sentinel Products), under Sustainable Soil Management (SSM) and Business As Usual (BAU) practices.</p>
</div>
<p>Another way of assessing this management change is by comparing results in years with higher availability of satellite images (2017-2020). During this period, areas under SSM showed greater vegetation cover through the year than BAU areas. This can be reflected by the probability of NDVI of exceeding a specific threshold (e.g. 0.3, indicating vegetated conditions; Fig. 16), in a particular year. In the case of SSM areas, 80-95% of the analysed images (183 in total) indicated vegetated conditions (NDVI &gt; 0.3), with soils being covered by actively growing vegetation through most of the year. On the contrary, BAU areas showed lower percentages, indicating a reduced vegetation cover through the year in all the analysed series.</p>
<div class="figure">
<img src="images/fig17.png" alt="" />
<p class="caption">Figure 17 Annual evolution of the Normalized Difference in Vegetation Index (NDVI; a); Bare Soil Index (BSI, b) and Normalized Difference WaterIndex (c) in the 2015-2021 series (Sentinel Products), under Sustainable Soil Management (SSM) and Business As Usual (BAU) practices.</p>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
